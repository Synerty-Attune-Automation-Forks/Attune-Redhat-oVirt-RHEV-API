
<!doctype html>
<html lang="en">




<head>
    <title>How to oVirt Set Disk Interface to VIRTIO_SCSI - Group - Attune Automation</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="title"
          content="How to oVirt Set Disk Interface to VIRTIO_SCSI - Group - Attune Automation">
    <meta name="description"
          content="">
    <meta name="robots"
          content="follow, index, max-snippet:-1, max-video-preview:-1, max-image-preview:large">

    <meta property="og:locale" content="en_AU" />
    <meta property="og:type" content="article" />
    <meta property="og:title"
          content="HowTo oVirt Set Disk Interface to VIRTIO_SCSI - Group - Attune Automation" />
    <meta property="og:description" content="" />
    <meta property="og:site_name" content="Attune Automation" />
    <meta property="article:section" content="IT Instruction" />

    <meta name="twitter:title"
          content="How to oVirt Set Disk Interface to VIRTIO_SCSI - Group - Attune Automation" />
    <meta name="twitter:description" content="" />

    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-32x32.png" sizes="32x32">
    <link rel="icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-192x192.png" sizes="192x192">
    <link rel="apple-touch-icon" href="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-180x180.png">
    <meta name="msapplication-TileImage" content="https://www.servertribe.com/wp-content/uploads/2020/10/cropped-server_tribe_favicon-270x270.png">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
          crossorigin="anonymous">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="styles/style.css">

    <!-- Google tag (gtag.js) -->
    <script async
            src="https://www.googletagmanager.com/gtag/js?id=G-5TZQZNDJCD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-5TZQZNDJCD');
    </script>
</head>


<body>

<!-- Project NavBar -->

<div class="bg-white border-bottom box-shadow sticky-top">
<div class="container px-0">
    <div class="row px-0">
        <div class="col d-flex flex-column flex-lg-row align-items-center px-0
            py-3">
            <a class="navbar-brand my-0 mr-lg-auto"
                  href="https://www.servertribe.com/"
                  target="_blank">
                    <img
                        src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                        alt="Attune - Powered by ServerTribe"
                        class="img-fluid navbar-img">
            </a>
            <nav class="my-2 my-lg-0 mr-lg-3">
                <a class="p-2 text-dark" href="https://docs.attuneautomation.com//"
                   target="_blank">
                    Documentation
                </a>
                <a class="p-2 text-dark"
                   href="https://discord.servertribe.com/"
                   target="_blank">
                    Discord
                </a>
                <a class="p-2 text-dark" href="https://github.com/Attune-Automation"
                   target="_blank">
                    GitHub
                </a>
                <a class="p-2 text-dark" href="https://www.servertribe.com/learn/"
                   target="_blank">
                    Learn
                </a>
            </nav>
            <a class="btn btn-outline-primary"
               href="https://www.servertribe.com/download-attune-registration/"
               target="_blank">
                Download NOW!
            </a>
        </div>
    </div>
</div></div>

<!-- Project breadcrumbs -->

<!-- Project breadcrumbs -->
<div class="container px-0">
    <div class="row">
        <nav class="col px-0" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="index.html">
                    <strong>Attune Project: </strong>Redhat oVirt/RHEV API
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    <strong>oVirt Set Disk Interface to VIRTIO_SCSI - Group</strong>
                </li>
            </ol>
        </nav>
    </div>
</div>

<!-- Blueprint Header -->

<div class="container px-0">
    <!-- Blueprint name and description -->
    <div class="row">
        <div class="col px-0">
            <h1 class="text-left">
                How to oVirt Set Disk Interface to VIRTIO_SCSI - Group
            </h1>
        </div>
    </div>

<!-- Blueprint Description -->
    <div class="row pt-4">
        <div class="col-6 px-0">
            <h6 class="text-left">
                This documentation is generated by
                <a href="https://www.servertribe.com/"
                    class="badge badge-primary"
                    target="_blank">
                    Attune
                </a>
            </h6>
        </div>
        <div class="col-6 align-self-end text-right px-0">
            <h6 class="text-right">
                <a href="https://www.youtube.com/@servertribe"
                    class="badge badge-secondary"
                    target="_blank">
                    YouTube
                </a>
                <a href="https://github.com/Attune-Automation"
                    class="badge badge-secondary"
                    target="_blank">
                    GitHub
                </a>
                <a href="https://discord.servertribe.com/"
                    class="badge badge-secondary"
                    target="_blank">
                    Discord
                </a>
                <a href="https://www.linkedin.com/company/servertribe/"
                    class="badge badge-secondary"
                    target="_blank">
                    LinkedIn
                </a>
                <a href="https://docs.attuneautomation.com"
                    class="badge badge-secondary"
                    target="_blank">
                    Documentation
                </a>
            </h6>
        </div>
    </div>
    <hr>
</div>

<div class="documentation">
    <div class="container px-0">
        <div class="row">

<!-- Blueprint ToC -->


            <div class="toc col-lg-2 px-0 pr-5">
                <div class="container px-0 pt-3">
                    <p class="pb-2">
                        <strong>Contents</strong>
                    </p>
                    <p class="text-muted">
                        <a href="#top">
                            <strong>oVirt Set Disk Interface to VIRTIO_SCSI - Group</strong>
                        </a>
                    </p>


    
        

                    <p class="text-muted pt-2">
                        <a href="#ovirtstopvm">
                            <strong>Step 1 -</strong> oVirt Stop VM
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#updatediskinterfacetovirtioscsi">
                            <strong>Step 2 -</strong> Update Disk Interface to VIRTIO_SCSI
                        </a>
                    </p>

        

                    <p class="text-muted pt-2">
                        <a href="#ovirtstartvm">
                            <strong>Step 3 -</strong> oVirt Start VM
                        </a>
                    </p>


                </div>
            </div>

<!-- Blueprint Contents -->
            <div class="col-lg-8 pt-3">
                <div class="container">


        <div class="jumbotron">
            <p class="display-3 text-center">
                <strong>Automate This</strong>
            </p>
            <p class="display-4 text-center">
                <strong>Get Attune</strong>
            </p>
            <p align="center">
                <a href="https://www.servertribe.com/download-attune-registration/">
                    <img src="https://img.shields.io/badge/download-latest-brightgreen.svg" /></a>
            </p>
            <hr class="my-4 text-center">
            <div class="col px-0">
                <p class="text-center">
                    Get the most out of automation with our get started
                    videos, product demonstrations, and more.
                </p>
                <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://www.servertribe.com/learn/"
                       target="_blank"
                       role="button">
                        Learn Attune Automation
                    </a>
                </p>
            </div>
        </div>
        <div class="row">
            <p>The following steps will guide you through the manual process.</p>
        </div>

<!-- Blueprint Steps -->


        



                    <div class="row pt-5">
                        <h3 id="ovirtstopvm">
                            <a href="#ovirtstopvm">
                                <strong>Step 1 -</strong> oVirt Stop VM
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>










                        <div class="row">
                            <p>
                                Connect via ssh:
                            </p>
                        </div>
                        <div class="row py-1">
                            <code class="language-sql">
ssh {kickstartworkerbuildlinuxuser}@{kickstartworkerlinuxnode}
                            </code>
                        </div>



    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
export PATH=~/ks_ovirt_py_venv/bin:$PATH

python3 &lt;&lt;&quot;EOF&quot;
import logging
import time
import sys

import ovirtsdk4 as sdk
import ovirtsdk4.types as types

logging.basicConfig(stream=sys.stdout, level=logging.INFO)
logger = logging.getLogger(&quot;Attune&quot;)

# This example will connect to the server, search for a VM by name and
# remove it:

# Create the connection to the server:
connection = sdk.Connection(
    url=&#x27;https://{ovirtEngineServer.fqn}/ovirt-engine/api&#x27;,
    username=&#x27;{ovirtEngineApiUser.user}&#x27;,
    password=&#x27;{ovirtEngineApiUser.password}&#x27;,
#    ca_file=&#x27;ca.pem&#x27;,
    insecure=True,
    debug=True,
    log=logger,
)
logger.info(&quot;Connection Successful&quot;)

# Find the service that manages VMs:
logger.info(&quot;Getting system_service&quot;)
system_service = connection.system_service()

logger.info(&quot;Getting vms_service&quot;)
vms_service = system_service.vms_service()

# Find the VM:
logger.info(&quot;Searchig for VM &#x27;name={kickstartedNode.fqn}&#x27;&quot;)
try:
    vm = vms_service.list(search=&#x27;name={kickstartedNode.fqn}&#x27;)[0]
    
except IndexError:
    logger.info(&quot;VM must not exist yet&quot;)
    exit(0)

# Note that the &quot;vm&quot; variable that we assigned above contains only the
# data of the VM, it doesn&#x27;t have any method like &quot;remove&quot;. Methods are
# defined in the services. So now that we have the description of the VM
# we can find the service that manages it, calling the locator method
# &quot;vm_service&quot; defined in the &quot;vms&quot; service. This locator method
# receives as parameter the identifier of the VM and retursn a reference
# to the service that manages that VM.

logger.info(&quot;Getting VM Service for VM ID=%s&quot; % vm.id)
vm_service = vms_service.vm_service(vm.id)

try:
    logger.info(&quot;Stopping VM&quot;)
    vm_service.stop(async_=False)
    
    # Wait till the virtual machine is down:
    while True:
        time.sleep(5)
        vm = vm_service.get()
        if vm.status == types.VmStatus.DOWN:
            break
    
except:
    logger.info(&quot;VM Must have already been stopped&quot;)
    pass

# Close the connection to the server:
connection.close()

EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="updatediskinterfacetovirtioscsi">
                            <a href="#updatediskinterfacetovirtioscsi">
                                <strong>Step 2 -</strong> Update Disk Interface to VIRTIO_SCSI
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
export PATH=~/ks_ovirt_py_venv/bin:$PATH

python3 &lt;&lt;&quot;EOF&quot;
import logging
import time
import sys

from pprint import pprint

import ovirtsdk4 as sdk
import ovirtsdk4.types as types

logging.basicConfig(stream=sys.stdout, level=logging.INFO)
logger = logging.getLogger(&quot;Attune&quot;)


connection = sdk.Connection(
    url=&#x27;https://{ovirtEngineServer.fqn}/ovirt-engine/api&#x27;,
    username=&#x27;{ovirtEngineApiUser.user}&#x27;,
    password=&#x27;{ovirtEngineApiUser.password}&#x27;,
    insecure=True,
    debug=True,
    log=logger,
)
logger.info(&quot;Connection Successful&quot;)

logger.info(&quot;Getting system_service&quot;)
system_service = connection.system_service()

logger.info(&quot;Getting vms_service&quot;)
vms_service = system_service.vms_service()

logger.info(&quot;Searchig for VM &#x27;name={kickstartedNode.fqn}&#x27;&quot;)
vm = vms_service.list(search=&#x27;name={kickstartedNode.fqn}&#x27;)[0]
logger.info(&quot;Found VM &#x27;name={kickstartedNode.fqn}&#x27;&quot;)

logger.info(&quot;Getting the disks service for the new disk&quot;)
disks_service = connection.system_service().disks_service()

disk = disks_service.list(search=&quot;alias={kickstartedNode.fqn}-disk0&quot;)[0]

logger.info(&quot;disk&quot;)
#pprint(dir(disk))

# logger.info(&quot;name=%s, alias = %s, id = %s, interface = %s, status=%s, actual_size=%s, description=%s&quot; % (disk.name, disk.alias, disk.id, disk.interface, disk.status, disk.actual_size, disk.description))

# disk_service = disks_service.disk_service(disk.id)

# disk_service.update(
#   disk=types.Disk(
#     interface=types.DiskInterface.VIRTIO_SCSI,
#     description=&quot;changed 10&quot;
#   )
# )

# disk = disks_service.list(search=&quot;alias={kickstartedNode.fqn}-disk0&quot;)[0]

# logger.info(&quot;name=%s, alias = %s, id = %s, interface = %s, status=%s, actual_size=%s, description=%s&quot; % (disk.name, disk.alias, disk.id, disk.interface, disk.status, disk.actual_size, disk.description))


logger.info(&quot;Getting the disk service&quot;)
vm_service = vms_service.vm_service(vm.id)
disk_attachments_service = vm_service.disk_attachments_service()

logger.info(&quot;Starting disk to appear&quot;)
while True:
    logger.info(&quot;Getting disk attatchment for %s&quot;, disk.name)
    disk_attachments = disk_attachments_service.list(search=&#x27;name=%s&#x27; % disk.name)
    if len(disk_attachments):
        break

logger.info(&quot;len disk_attachments=%s&quot; % len(disk_attachments))

disk = disk_attachments[0]
logger.info(&quot;name=%s, id=%s, interface=%s&quot; % (disk.name, disk.id, disk.interface))

disk_attachment_service = disk_attachments_service.attachment_service(disk.id)

#pprint(dir(disk_attachment_service))
#disk_service = disks_service.disk_service(disk.id)


#disk_attachment_service = vms_service.vm_service(vm.id).disk_attachment_service()


disk_attachment_service.update(
  disk_attachment=types.DiskAttachment(
    interface=types.DiskInterface.VIRTIO_SCSI
  )
)

# logger.info(&quot;Getting the disk service for the new disk&quot;)
# disk_service = disks_service.disk_service(disk_attachment.disk.id)



# Close the connection to the server:
connection.close()


EOF
                </code>
            </pre>
        </div>
    </div>





        



                    <div class="row pt-5">
                        <h3 id="ovirtstartvm">
                            <a href="#ovirtstartvm">
                                <strong>Step 3 -</strong> oVirt Start VM
                            </a>
                        </h3>
                    </div>

                    <div class="row">
                        <div class="description col px-0">
                            <p>
                                
                            </p>
                        </div>
                    </div>









    


    



    <div class="row">
        <p>
            Execute the following script:
        </p>
    </div>
    <div class="row">
        <div class="col px-0">
            <pre>
                <code class="language-sql py-0">
export PATH=~/ks_ovirt_py_venv/bin:$PATH

python3 &lt;&lt;&quot;EOF&quot;
import logging
import time
import sys

import ovirtsdk4 as sdk
import ovirtsdk4.types as types

logging.basicConfig(stream=sys.stdout, level=logging.INFO)
logger = logging.getLogger(&quot;Attune&quot;)

# This example will connect to the server and create a new virtual machine:

# Create the connection to the server:
connection = sdk.Connection(
    url=&#x27;https://{ovirtEngineServer.fqn}/ovirt-engine/api&#x27;,
    username=&#x27;{ovirtEngineApiUser.user}&#x27;,
    password=&#x27;{ovirtEngineApiUser.password}&#x27;,
    insecure=True,
    debug=True,
    log=logger,
)
logger.info(&quot;Connection Successful&quot;)

# Find the service that manages VMs:
logger.info(&quot;Getting system_service&quot;)
system_service = connection.system_service()

logger.info(&quot;Getting vms_service&quot;)
vms_service = system_service.vms_service()

logger.info(&quot;Searchig for VM &#x27;name={kickstartedNode.fqn}&#x27;&quot;)
vm = vms_service.list(search=&#x27;name={kickstartedNode.fqn}&#x27;)[0]

logger.info(&quot;Getting VM Service for VM ID=%s&quot; % vm.id)
vm_service = vms_service.vm_service(vm.id)

logger.info(&quot;Getting the disks service for the new disk&quot;)
disks_service = system_service.disks_service()

diskName=&#x27;{kickstartedNode.fqn}-disk0&#x27;
search_string=&quot;name=%s&quot; % diskName

logger.info(&quot;Getting the disk service for the new disk&quot;)
disks_service = system_service.disks_service()
disks_service_list = disks_service.list(search=search_string)

if len(disks_service_list) == 0:
    logger.info(&quot;No ISO disks found&quot;)
    exit(1)
else:
    disk = disks_service_list[0]
    logger.info(&quot;disk status = %s&quot; % disk.status)

    logger.info(&quot;Starting to wait for disk to become online&quot;)
    while True:
        logger.info(&quot;Wait for disk to become online&quot;)
        time.sleep(5)
        
        disk_service = disks_service.disk_service(disk.id)
        disk = disk_service.get()
        if disk.status == types.DiskStatus.OK:
            break
  
logger.info(&quot;Booting VM to CDROM&quot;)
vm_service.start()

# additional documentation about attributes and types that can be changed:
# https://your.rhv.host/ovirt-engine/api/model#types/vm
# https://your.rhv.host/ovirt-engine/api/model#types/operating_system
# https://your.rhv.host/ovirt-engine/api/model#types/boot
# https://your.rhv.host/ovirt-engine/api/model#types/boot_device


# Wait till the virtual machine is up:
while True:
    time.sleep(5)
    vm = vm_service.get()
    if vm.status == types.VmStatus.UP:
        break

# Close the connection to the server:
connection.close()


EOF
                </code>
            </pre>
        </div>
    </div>






                    <div class="row pt-5">
                        <div class="col">
                            <h2>Completed</h2>
                            <p>
                                You have completed this instruction.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

<!-- Download Attune Ad -->

            <div class="toc col-lg-2 px-0">
                <div class="container px-0 pt-3 pl-5">
                    <div class="card border-light mb-3" style="max-width: 18rem;">
                        <div class="card-body attune-ad">
                            <img
                                src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                                alt="Attune - Powered by ServerTribe"
                                class="img-fluid">
                            <p class="card-title mt-3 text-center">
                                <strong>Automate with Attune</strong>
                            </p>
                            <p class="card-text text-center">
                                Download the Attune Community Edition.
                            </p>
                            <p class="text-center">
                                <a href="https://www.servertribe.com/download-attune-registration/"
                                   class="btn btn-primary mt-3">
                                    DOWNLOAD!!!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

<!-- Join Discord -->

        <div class="row py-5">
            <div class="jumbotron">
              <h1 class="display-4 text-center">
                  Discuss this Project in Discord
              </h1>
              <p class="lead">

                  Join our Discord channel and connect with like-minded individuals who
                  share your passion. Engage in lively discussions, gain valuable insights,
                  and stay updated on the latest trends in our industry. Don't miss out on
                  this opportunity to network, learn, and grow together.
              </p>
              <hr class="my-4 text-center">
                <div class="col px-0">
                  <p class="text-center">
                      Click the link below and become a part of our vibrant community on
                      Discord today!
                  </p>
                  <p class="lead text-center">
                    <a class="btn btn-primary btn-lg"
                       href="https://discord.servertribe.com/"
                       role="button">
                        Join NOW!!!
                    </a>
                  </p>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- Project Footer -->

<footer class="footer fixed-bottom bg-white border-top box-shadow">
      <div class="container px-0">
          <div class="row">
              <div class="col px-0">
                  <a class="my-0 mr-lg-auto"
                     href="https://www.servertribe.com/"
                     target="_blank">
                      <img
                          src="https://www.servertribe.com/wp-content/uploads/2022/06/AttuneLogoV2_powered_by.png"
                          alt="Attune - Powered by ServerTribe"
                          class="img-fluid navbar-img">
                  </a>
              </div>
          </div>
      </div>
</footer>


<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>


</body>
</html>
